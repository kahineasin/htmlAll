function checkXHRLogin(a){void 0!==a.responseURL&&-1<a.responseURL.indexOf("/User/Login?ReturnUrl=")&&(window.location.href="/User/Login")}function pfRequestSuccess(a){return function(b,c,e){if(null!==b&&void 0!==b){if("loginout"===b||"string"===typeof b&&-1<b.indexOf('value="\u767b\u5f55"')){window.location.href="/User/Login";return}if(b&&1801===b.Status){window.location.href="/Hyzl/Home/SelectMonth?sourceUrl="+b.BackUrl;return}}a?a(b,c,e):b&&b.Message&&alert(b.Message)}}var $pf=$pf||{};
$pf.post=function(a,b,c,e){c=pfRequestSuccess(c);return $.post(a,b,c,e)};$pf.get=function(a,b,c,e){c=pfRequestSuccess(c);return $.get(a,b,c,e)};
$pf.exporter=function(a){var b=this,c={action:window.location.pathname.replace(/^(\/[^\/]+\/[^\/]+).*$/,"$1/download"),dataGetter:"api",dataAction:"",dataParams:{},titles:[[]],fileType:"xls",compressType:"none"};this.paging=function(f,g){b.params.dataParams.page=f;b.params.dataParams.rows=g;return b};this.compress=function(){b.params.compressType="zip";return b};this.title=function(f,g){b.params.titles[f]=g;return b};this.download=function(f){b.params.fileType=f||"xls";b.params.dataParams=JSON.stringify(b.params.dataParams);
b.params.titles=JSON.stringify(b.params.titles);if(f=$('<iframe style="display:none;" class="downloadHelper"></iframe>').appendTo("body")[0].contentWindow.document){f.open();f.write("");f.writeln($pf.formatString("<html><body><form id='downloadForm' name='downloadForm' method='post' action='{0}'>",b.params.action));for(var g in b.params)f.writeln($pf.formatString("<input type='hidden' name='{0}' value='{1}'>",g,b.params[g]));f.writeln("</form></body></html>");f.close();(g=f.forms[0])&&g.submit()}};
var e=function(f){var g=f.$element().datagrid("options");f.treegrid&&(g.url=g.url||f.treegrid("options").url);f=[[]];for(var k=Math.max(g.frozenColumns.length,g.columns.length),h=0;h<k;h++)f[h]=(g.frozenColumns[h]||[]).concat(g.columns[h]||[]);b.params=$.extend(!0,{},c,{dataAction:g.url,dataParams:g.queryParams,titles:f})};a.$element?e(a):b.params=$.extend(!0,{},c,a);return b};
$pf.formatString=function(){for(var a=1;a<arguments.length;a++)arguments[0]=arguments[0].replace(new RegExp("\\{"+(a-1)+"\\}","gm"),arguments[a]);return arguments[0]};$pf.stringIsNullOrWhiteSpace=function(a){return null===a||void 0===a||""===a.toString().replace(" ","").replace("\u00a0","")};$pf.stringDesensitization=function(a,b,c){if($pf.stringIsNullOrWhiteSpace(a))return a;for(var e="",f=0;f<a.length;f++)e=f<b||f>a.length-1-c?e+"*":e+a[f];return e};
$pf.identificationDesensitization=function(a){return $pf.stringDesensitization(a,0,4)};$pf.isDecimal=function(a,b){if(a){var c="^[0-9]+.{0,1}[0-9]";return(new RegExp((null==b||void 0==b?c+"*":c+("{0,"+b+"}"))+"$","g")).test(a)}return!0};$pf.isInt=function(a){return a?a.match(/^[0-9]+$/g):!0};$pf.objectToBool=function(a){var b=null;if("1"===a||"true"===a||"True"===a)b=!0;else if("0"===a||"false"===a||"False"===a)b=!1;return b};
$pf.thousandth=function(a){a="number"==typeof a?a.toString():a;return null!==a&&void 0!==a?-1<a.indexOf(".")?a.replace(/(\d)(?=(\d{3})+\.)/g,"$1,"):a.replace(/(\d)(?=(\d{3})+$)/g,"$1,"):a};$pf.num2e=function(a){var b=Math.floor(Math.log(a)/Math.LN10);return a*Math.pow(10,-b)+"e"+b};$pf.toFixed=function(a,b){if(null===b||void 0===b)b=2;return"number"==typeof a?a.toFixed(b):parseFloat(a).toFixed(b)};
$pf.formatTime=function(a,b){if(!a)return"";var c=a;"string"===typeof a&&(c=-1<a.indexOf("/Date(")?new Date(parseInt(a.replace("/Date(","").replace(")/",""),10)):new Date(Date.parse(a.replace(/-/g,"/").replace("T"," ").split(".")[0])));a={"M+":c.getMonth()+1,"d+":c.getDate(),"h+":c.getHours(),"m+":c.getMinutes(),"s+":c.getSeconds(),"q+":Math.floor((c.getMonth()+3)/3),S:c.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(c.getFullYear()+"").substr(4-RegExp.$1.length)));for(var e in a)(new RegExp("("+
e+")")).test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?a[e]:("00"+a[e]).substr((""+a[e]).length)));return b};$pf.formatDate=function(a){return $pf.formatTime(a,"yyyy-MM-dd")};function PFTimeSpan(a){this._ymd=a||{hour:!0,minute:!0,second:!0};this.millisecond=this.second=this.minute=this.hour=0}
PFTimeSpan.prototype.toString=function(){var a=this._ymd,b="";a.hour&&0!==this.hour&&(b+=this.hour+"\u65f6");a.minute&&0!==this.minute&&(b+=this.minute+"\u5206");a.second&&0!==this.second&&(b+=this.second+"\u79d2");a.millisecond&&0!==this.millisecond&&(b+=this.millisecond+"\u6beb\u79d2");return b};$pf.getTimeSpan=function(a,b,c){a=a.getTime();b=b.getTime();return $pf.getTimeSpanByMilliseconds(b-a)};
$pf.getTimeSpanByMilliseconds=function(a,b){var c=new PFTimeSpan(b);b=c._ymd;a/=1E3;b.hour&&(c.hour=parseInt(a/3600),a-=3600*c.hour);b.minute&&(c.minute=parseInt(a/60),a-=60*c.minute);b.second&&(c.second=parseInt(a),a-=c.second);b.millisecond&&(c.millisecond=a);return c};$pf.cmonthToDate=function(a){var b=parseInt(a.substr(0,4));a=parseInt(a.substr(5,2));return new Date(b,a,1)};
$pf.compareCMonth=function(a,b){a=$pf.cmonthToDate(a);b=$pf.cmonthToDate(b);return 12*(b.getFullYear()-a.getFullYear())+(b.getMonth()-a.getMonth())};$pf.getFileSize=function(a,b){b=b||{GB:!0,MB:!0,KB:!0};var c={};b.GB&&(c.GB=parseInt(a/1048576),a-=1048576*c.GB);b.MB&&(c.MB=parseInt(a/1024),a-=1024*c.MB);b.KB&&(c.KB=a);return c};
$pf.formatFileSize=function(a,b){b=b||{GB:!0,MB:!0,KB:!0};a=$pf.getFileSize(a,b);var c="";b.GB&&0<a.GB&&(c+=a.GB+"GB ");b.MB&&0<a.MB&&(c+=a.MB+"MB ");b.KB&&0<a.KB&&(c+=a.KB+"KB ");0<c.length&&(c=c.substr(0,c.length-1));return c};
$pf.stringToDate=function(a,b){if(!a)return"";a=a.toString();var c={"M+":"01","d+":"01","h+":"01","m+":"01","s+":"01","q+":"01",S:"01"},e=-1,f=(new RegExp(/(y+)/)).exec(b);null!=f&&(e=a.substr(f.index,f[0].length));for(var g in c)c.hasOwnProperty(g)&&(f=(new RegExp(g)).exec(b),null!=f&&(c[g]=a.substr(f.index,f[0].length)));return new Date($pf.formatString("{0}/{1}/{2} {3}:{4}:{5}",e,c["M+"],c["d+"],c["h+"],c["m+"],c["s+"]))};$pf.randomNext=function(a,b){return Math.floor(Math.random()*(b-a))+a};
$pf.listRandomTake=function(a,b,c){c=c||!1;var e=[];if(null==a)return a;if(a.length<=b)return c?e=a.splice(0,a.length):a;for(a=c?a:a.slice(0);e.length<b;)c=$pf.randomNext(0,a.length),e.push(a[c]),a.splice(c,1);return e};
$pf.listRandomTakeContainer=function(a){var b=a.slice(0),c=null;return{randomTake:function(e){if(1>b.length){b=a.slice(0);for(var f=null,g=0;g<b.length;g++)b[g]==c&&(f=b.splice(g,1)[0]);e=$pf.listRandomTake(b,e,!0);null!==f&&b.push(f)}else e=$pf.listRandomTake(b,e,!0);c=e[0];return e},getRestCount:function(){return b.length}}};$pf.stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0};$pf.fireEvent=function(a,b,c){$("#"+a).trigger(b,c)};
$pf.getJQ=function(a){return a instanceof jQuery?a:jQuery(a)};
$pf.expandTree=function(a){a=$pf.getJQ(a);var b=a.parent("tr"),c=b.attr("level"),e=b.attr("expanded");if(null!=c&&void 0!=c){c=parseInt(c);for(var f=b;0<(f=f.next("tr[level]")).length;){var g=parseInt(f.attr("level"));if(g<=c)break;if(g===c+1||"expanded"===e)"expanded"==e?f.css("display","none"):(f.css("display","table-row"),g=f.find(".hitarea"),g.removeClass("hitarea-expanded"),g.addClass("hitarea-closed"),f.removeAttr("expanded"))}a=a.find(".hitarea");"expanded"==e?(a.removeClass("hitarea-expanded"),
a.addClass("hitarea-closed")):(a.removeClass("hitarea-closed"),a.addClass("hitarea-expanded"))}"expanded"==e?b.removeAttr("expanded"):b.attr("expanded","expanded")};$pf.eachLeaf=function(a,b){for(var c=0;c<a.Children.length;c++){var e=a.Children[c];0<e.Children.length?$pf.eachLeaf(e,b):b(e)}};$pf.getAllLeafCount=function(a,b){var c=0;$pf.eachLeaf(a,function(e){(null==b||b(e))&&c++});return c};
$pf.eachChild=function(a,b,c){if(null===c||void 0===c)c=2;for(var e=0;e<a.Children.length;e++){var f=a.Children[e];b(f,c,a);$pf.eachChild(f,b,c+1)}};$pf.eachChildWithLast=function(a,b,c){if(null===c||void 0===c)c=2;for(var e=a.Children.length,f=0;f<e;f++){var g=a.Children[f];b(g,c,f==e-1,a);$pf.eachChildWithLast(g,b,c+1)}};$pf.getDepth=function(a){var b=1;$pf.eachChild(a,function(c,e){e>b&&(b=e)});return b};
$pf.uploadFile=function(a,b,c){function e(){"function"===typeof error&&error()}c=c||{};var f=c.success,g=c.typeStr;c=c.maxSize||2048;a=a.files||a[0].files;if(null!==a&&void 0!==a&&0<a.length)if(a=a[0],null===g||void 0===g||0<=g.indexOf(a.type))if(a.size>1024*c)alert("\u4e0a\u4f20\u7684\u6587\u4ef6\u4e0d\u80fd\u5927\u4e8e"+$pf.formatFileSize(c,{GB:!0,MB:!0})),e();else{var k=layer.load("\u6b63\u5728\u4e0a\u4f20\u8bf7\u7a0d\u5019");g=new FormData;g.append("file1",a);b=b?b:"";var h=null;if(h=window.XMLHttpRequest?
new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null)h.open("POST",b),h.onreadystatechange=function(){if(4==h.readyState&&(k&&layer.close(k),200==h.status)){var m=h.responseText;checkXHRLogin(h);if("function"===typeof f){var n=m;try{n=JSON.parse(m)}catch(p){}f(n)}h=null}},h.send(g)}else alert("\u8bf7\u4e0a\u4f20\u683c\u5f0f\u4e3a"+g+"\u7684\u56fe\u7247"),e()};
$pf.getEnMonthByNum=function(a){switch(a){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec";default:return""}};$pf.getRequest=function(){var a=location.search,b={};if(-1!==a.indexOf("?")){a=a.substr(1).split("&");for(var c=0;c<a.length;c++)b[a[c].split("=")[0]]=unescape(a[c].split("=")[1])}return b};
$pf.setUrlParams=function(a,b){function c(k,h,m){if(m instanceof Array)for(var n=0;n<m.length;n++)k+=h+"="+m[n]+"&";else k+=h+"="+m+"&";return k}function e(k,h){return k.replace(new RegExp("([&?]{1})"+h+"[\\[\\]]{0,2}=[^&]*[&]{0,1}","g"),"$1")}if(0>a.indexOf("?"))a+="?";else{var f=a[a.length-1];"?"!==f&&"&"!==f&&(a+="&")}if(b instanceof Array){for(var g=0;g<b.length;g++)a=e(a,b[g].name);for(g=0;g<b.length;g++)a=c(a,b[g].name,b[g].value)}else{for(g in b)b.hasOwnProperty(g)&&(a=e(a,g));for(g in b)b.hasOwnProperty(g)&&
(a=c(a,g,b[g]))}"&"===a[a.length-1]&&(a=a.substr(0,a.length-1));return a};
$pf.getTableColumnIdxs=function(a){a=$(a).find("thead").children();var b={},c=[],e=0;$(a[0]).children().each(function(k,h){h=$(h);k=parseInt(h.attr("colspan")||1);if(1===k)b[e]=h.attr("field-name")||h.text();else for(h=e;h<e+k;h++)c.push(h);e+=k});if(0<c.length)for(l=1;l<a.length;l++){var f=c[0];$(a[l]).children().each(function(k,h){k=$(h);h=parseInt(k.attr("colspan")||1);1===h&&(b[f]=k.attr("field-name")||k.text(),c.splice(c.indexOf(f),1));f+=h});if(1>c.length)break}a=[];for(var g=0;g<e;g++)a.push(b[g]);
return a};$pf.bindTableColumnClick=function(a,b,c){b=$pf.getTableColumnIdxs(a).indexOf(b);null!==b&&void 0!==b&&(a=a.find("tbody tr td:nth-child("+(b+1)+")"),a.unbind("click",c),a.bind("click",c),a.css("textDecoration","underline"),a.css("cursor","pointer"))};$pf.bindTableRowClick=function(a,b){a.on("click","tbody tr",b)};
$pf.mergeTableCell=function(a,b){b=$pf.getTableColumnIdxs(a).indexOf(b);a=a.find("tbody tr td:nth-child("+(b+1)+")");var c="",e={};a.each(function(f,g){f=$(g).text();if(null===e[f]||void 0===e[f])e[f]=0;e[f]+=1});a.each(function(f,g){f=$(g);g=f.text();c!==g&&null!==e[g]&&void 0!==e[g]?f.attr("rowspan",e[g]):f.css("display","none");c=g})};
$pf.copyTableHeadWidth=function(a,b,c){for(var e=0,f=0;f<b.find("tr").length;f++)for(var g=b.find("tr").eq(f),k=a.find("tr").eq(f),h=0;h<g.find("th").length;h++){var m=g.find("th").eq(h),n=k.find("th").eq(h),p=n[0].getBoundingClientRect();c&&0===f&&(e+=p.width);m.css("minWidth",p.width-1-parseInt(n.css("paddingLeft").replace("px"))-parseInt(n.css("paddingRight").replace("px"))+"px")}c&&b.parents("table:eq(0)").width(e+"px")};
$pf.copyTableHeadSize=function(a,b,c){for(var e=0,f=0;f<b.find("tr").length;f++)for(var g=b.find("tr").eq(f),k=a.find("tr").eq(f),h=0;h<g.find("th").length;h++){var m=g.find("th").eq(h),n=k.find("th").eq(h),p=n[0].getBoundingClientRect();c&&0===f&&(e+=p.width);m.css("minWidth",p.width-1-parseInt(n.css("paddingLeft").replace("px"))-parseInt(n.css("paddingRight").replace("px"))+"px");m.css("height",p.height-1-parseInt(n.css("paddingTop").replace("px"))-parseInt(n.css("paddingBottom").replace("px"))+
"px")}c&&b.parents("table:eq(0)").width(e+"px")};$pf.monthSubtract=function(a,b){a=a.split(".");b=b.split(".");return 12*(parseInt(a[0])-parseInt(b[0]))+parseInt(a[1])-parseInt(b[1])};$pf.setFormValues=function(a,b){a.find("input[type=text],input[type=select],input[type=number]").each(function(c,e){c=$(e);e=b[e.name];void 0!==e&&c.val(e)})};
$pf.resetForm=function(a){a[0].reset();a.find("select.iselect").each(function(b,c){b=$(this);c=b.next();c.hasClass("iselwrap-val")&&c.text(b.find("option:selected").text())});a.find(".pf-fileupload").each(function(b,c){$(this).find("span").html("")});a.find("input[name=isHybhAsTeam]").each(function(b,c){b=$(this);b.val(b.parent().find("input[name=selectTeamCheckBox]").is(":checked"))})};
$pf.disableField=function(a){for(var b=0;b<arguments.length;b++){var c=arguments[b];if("INPUT"===c[0].nodeName)"radio"===c.attr("type")?c.filter(function(){return!$(this).is(":checked")}).attr("disabled","disabled"):"checkbox"===c.attr("type")?c.attr("onclick","return false;"):(c.attr("readonly","readonly"),c.hasClass("Wdate")&&c.removeAttr("onclick"));else if("SELECT"===c[0].nodeName){c.attr("disabled","disabled");var e=c[0].getAttribute("id")+"_hidden",f=document.getElementById(e);if(null===f||
void 0===f)f=document.createElement("input"),f.setAttribute("type","hidden"),f.setAttribute("id",e),f.name=c[0].name,c[0].parentNode.insertBefore(f,c[0]);f.value=c[0].value}}};
$pf.enableField=function(a){for(var b=0;b<arguments.length;b++){var c=arguments[b];"INPUT"===c[0].nodeName?"radio"===c.attr("type")?c.filter(function(){return!$(this).is(":checked")}).removeAttr("disabled"):"checkbox"===c.attr("type")?"return false;"===c.attr("onclick")&&c.removeAttr("onclick"):(c.removeAttr("readonly"),c.hasClass("Wdate")):"SELECT"===c[0].nodeName&&(c.removeAttr("disabled"),c=c[0].getAttribute("id")+"_hidden",c=document.getElementById(c),$(c).remove())}};
$pf.disableButton=function(a){for(var b=0;b<arguments.length;b++){var c=arguments[b];"A"!==c[0].nodeName&&"INPUT"!==c[0].nodeName||"disabled"===c.attr("disabled")||c.attr("disabled","disabled")}};$pf.enableButton=function(a){for(var b=0;b<arguments.length;b++){var c=arguments[b];"A"!==c[0].nodeName&&"INPUT"!==c[0].nodeName||"disabled"!==c.attr("disabled")||c.removeAttr("disabled")}};
$pf.watermark=function(a){if(!$pf.hasWatermark&&!parent.$pf.hasWatermark){$pf.hasWatermark=!0;var b=null,c=function(){var e={watermark_txt:"text",watermark_x:20,watermark_y:20,watermark_rows:20,watermark_cols:20,watermark_x_space:100,watermark_y_space:50,watermark_color:"#aaa",watermark_alpha:.4,watermark_fontsize:"15px",watermark_font:"\u5fae\u8f6f\u96c5\u9ed1",watermark_width:210,watermark_height:80,watermark_angle:15};if(1===arguments.length&&"object"===typeof arguments[0]){var f=arguments[0]||
{};for(key in f)f[key]&&e[key]&&f[key]===e[key]||f[key]&&(e[key]=f[key])}f=Math.max(document.body.scrollWidth,document.body.clientWidth);f-=.015*f;var g=Math.max(document.body.scrollHeight,document.body.clientHeight)-100;if(0==e.watermark_cols||parseInt(e.watermark_x+e.watermark_width*e.watermark_cols+e.watermark_x_space*(e.watermark_cols-1))>f)e.watermark_cols=parseInt((f-e.watermark_x+e.watermark_x_space)/(e.watermark_width+e.watermark_x_space)),e.watermark_x_space=parseInt((f-e.watermark_x-e.watermark_width*
e.watermark_cols)/(e.watermark_cols-1));if(0==e.watermark_rows||parseInt(e.watermark_y+e.watermark_height*e.watermark_rows+e.watermark_y_space*(e.watermark_rows-1))>g)e.watermark_rows=parseInt((e.watermark_y_space+g-e.watermark_y)/(e.watermark_height+e.watermark_y_space)),e.watermark_y_space=parseInt((g-e.watermark_y-e.watermark_height*e.watermark_rows)/(e.watermark_rows-1)),isNaN(e.watermark_y_space)&&(e.watermark_y_space=1);null!=b&&$(".mask_div").remove();b=document.createDocumentFragment();for(var k=
0;k<e.watermark_rows;k++){g=e.watermark_y+(e.watermark_y_space+e.watermark_height)*k;for(var h=0;h<e.watermark_cols;h++){f=e.watermark_x+(e.watermark_width+e.watermark_x_space)*h;var m=document.createElement("div");m.id="mask_div"+k+h;m.className="mask_div";m.appendChild(document.createTextNode(e.watermark_txt));m.style.webkitTransform="rotate(-"+e.watermark_angle+"deg)";m.style.MozTransform="rotate(-"+e.watermark_angle+"deg)";m.style.msTransform="rotate(-"+e.watermark_angle+"deg)";m.style.OTransform=
"rotate(-"+e.watermark_angle+"deg)";m.style.transform="rotate(-"+e.watermark_angle+"deg)";m.style.visibility="";m.style.position="absolute";m.style.left=f+"px";m.style.top=g+"px";m.style.overflow="hidden";m.style.zIndex="9999";m.style.pointerEvents="none";m.style.opacity=e.watermark_alpha;m.style.fontSize=e.watermark_fontsize;m.style.fontFamily=e.watermark_font;m.style.color=e.watermark_color;m.style.textAlign="center";m.style.width=e.watermark_width+"px";m.style.height=e.watermark_height+"px";m.style.display=
"block";b.appendChild(m)}}document.body.appendChild(b)};c(a);$pf.EleResize.on(document.body,function(){c(a)})}};$pf.clearIframe=function(a){0<a.length&&(a[0].contentWindow.document.clear(),a[0].contentWindow.close())};$pf.getMainPageWindow=function(){for(var a=[],b=window;b!=top;)a.push(b),b=b.parent;return 2>a.length?window:a[a.length-2]};
$pf.progressPost=function(a,b,c,e,f,g){return $pf.post(a,b,function(k,h,m){var n=!0;try{c(k,h,m),n=!0!==e(k,h,m)}catch(p){}n&&setTimeout(function(){$pf.progressPost(a,k,c,e,f,g)},f)},g)};
$pf.copyDomBorder=function(a,b,c){c=c||{up:!0,right:!0,down:!0,left:!0};c.right&&(c=a.css("borderRight"),$pf.stringIsNullOrWhiteSpace(c)?(b.css("borderRightWidth",a.css("borderRightWidth")),b.css("borderRightStyle",a.css("borderRightStyle")),b.css("borderRightColor",a.css("borderRightColor"))):b.css("borderRight",c))};
$pf.distancePtSeg=function(a,b,c){var e=c[0]-b[0],f=c[1]-b[1];c=c[2]-b[2];var g=a[0]-b[0],k=a[1]-b[1],h=a[2]-b[2],m=e*e+f*f+c*c;h=e*g+f*k+c*h;0<m&&(h/=m);0>h?h=0:1<h&&(h=1);g=b[0]+h*e-a[0];k=b[1]+h*f-a[1];h=b[2]+h*c-a[2];return g*g+k*k+h*h};
$pf.getDistanceBetweenPointAndRect=function(a,b,c){c=c.length&&"number"==typeof c.length?c:[c];for(var e=-1,f=0;f<c.length;f++){var g=c[f];g=Math.sqrt(Math.pow(a<g.left?g.left-a:a>g.left+g.width?a-(g.left+g.width):0,2)+Math.pow(b<g.top?g.top-b:b>g.top+g.height?b-(g.top+g.height):0,2));if(0===f||g<e)e=g}return e};
$pf.findNearestChild=function(a,b,c){if(void 0===a.childNodes||null===a.childNodes||1>a.childNodes.length)return a;for(var e=a.childNodes,f=-1,g=-1,k=0;k<e.length;k++){var h=document.createRange();h.selectNode(e[k]);h=h.getClientRects();!(1>h.length)&&(d=$pf.getDistanceBetweenPointAndRect(b,c,h),-1===f||d<f)&&(f=d,g=k)}return-1===g?a:$pf.findNearestChild(a.childNodes[g])};
$pf.selectNodeByXY=function(a,b){var c=$pf.findNearestChild(document.elementFromPoint(a,b),a,b),e=-1,f=0,g=c.length||0,k=document.createRange();k.selectNode(c);for(var h=0;h<=g;h++){k.setStart(c,h);k.setEnd(c,h);var m=k.getClientRects();!(1>m.length)&&(d=$pf.getDistanceBetweenPointAndRect(a,b,m),-1===e||d<e)&&(e=d,f=h)}return{isTextNode:3===c.nodeType,node:c,pos:f}};$pf.setLocalStorage=function(a,b){null===b||void 0===b||1>b.length?localStorage.removeItem(a):localStorage.setItem(a,JSON.stringify(b))};
$pf.getLocalStorage=function(a){a=localStorage.getItem(a);return null!==a&&""!==a?JSON.parse(a):null};$pf.listFind=function(a,b){var c="string"===typeof b,e;for(e in a)if(a.hasOwnProperty(e))if(c){if(e===b)return a[e]}else if(b(a[e]))return a[e];return null};$pf.listSelect=function(a,b){var c="string"===typeof b,e=[],f;for(f in a)a.hasOwnProperty(f)&&(c?e.push(a[f][b]):e.push(b(a[f])));return e};
$pf.setOddEvenRowCss=function(a){var b=!0;a.find("tr").each(function(){var c=$(this);b?c.removeClass("even").addClass("odd"):c.removeClass("odd").addClass("even");b=!b})};function TreeMatrix(){this.node={};this.lastChild={};this.net={};this.yMax=this.xMax=0}TreeMatrix.prototype.setMatrix=function(a,b,c){void 0===a[b]&&(a[b]={});a[b][c]=1;b-1>this.xMax&&(this.xMax=b-1);c>this.yMax&&(this.yMax=c)};
TreeMatrix.prototype.initByTreeList=function(a){var b=this,c=0,e;for(e in a)if(a.hasOwnProperty(e)){var f=a[e];b.setNode(0,c);a.length-1==c&&b.setLastChild(0,c);c++;$pf.eachChildWithLast(f,function(g,k,h){b.setNode(k-1,c);h&&b.setLastChild(k-1,c);c++})}b.setNetByNode()};TreeMatrix.prototype.setNode=function(a,b){this.setMatrix(this.node,a,b)};TreeMatrix.prototype.setLastChild=function(a,b){this.setMatrix(this.lastChild,a,b)};
TreeMatrix.prototype.setNetByNode=function(){for(var a=0;a<=this.xMax;a++)for(var b=1;b<=this.yMax;b++)void 0===this.net[a]&&(this.net[a]={}),void 0===this.net[a][b]&&(this.net[a][b]={}),this.net[a][b].right=1===this.node[a+1][b]?1:0,this.net[a][b].up=this.net[a][b-1]&&this.net[a][b-1].down||1===this.node[a][b-1]?1:0,this.net[a][b].down=0!==this.net[a][b].up&&1!==this.lastChild[a+1][b]?1:0};
TreeMatrix.prototype.getNetLine=function(a,b){a=this.net[a][b];return a.up&&a.right&&a.down?"\u251d":a.up&&a.down?"\u2502":a.up&&a.right?"\u2515":"  "};$pf.getBrowerViewSize=function(){function a(e,f){return 0<e&&e<f?e:f}var b=window.innerWidth,c=window.innerHeight;b=a(document.documentElement.clientWidth,b);c=a(document.documentElement.clientHeight,c);b=a(window.screen.width,b);c=a(window.screen.height,c);b=a(window.screen.availWidth,b);c=a(window.screen.availHeight,c);return{width:b,height:c}};
$pf.absoluteCenter=function(a){var b=a.getBoundingClientRect(),c=sellgirl.getBrowerViewSize();a.style.position="fixed";a.style.top=(c.height-b.height)/2+"px";a.style.left=(c.width-$(a).width())/2+"px"};$pf.centerAlign=function(a,b){var c=$pf.getJQ(a),e=a.getBoundingClientRect();b=b.getBoundingClientRect();a.style.top=(b.height-e.height)/2+b.top+"px";a.style.left=(b.width-c.width())/2+b.left-parseInt(c.css("marginLeft").replace("px",""))+"px"};
$pf.generateLayerTo=function(a,b){return $.layer({time:0,title:!1,dialog:{msg:a,type:16},closeBtn:!1,success:function(c){var e=c.parent().find(".xubox_shade"),f=b[0].getBoundingClientRect(),g=c[0].getBoundingClientRect();e.width(f.width);e.height(f.height);e.css("top",f.top+"px");e.css("left",f.left+"px");c.css("top",(f.height-g.height)/2+f.top+"px");c.css("left",(f.width-g.width)/2+f.left-parseInt(c.css("marginLeft").replace("px",""))+"px")}})};
null!==jQuery&&void 0!==jQuery&&(jQuery.fn.pfPost=function(a,b,c,e){var f=this;return"A"!==f[0].nodeName&&"INPUT"!==f[0].nodeName||"disabled"===f.attr("disabled")?null:(f.attr("disabled","disabled"),a=$pf.post(a,b,c,e),"function"==typeof a.complete?a.complete(function(){f.removeAttr("disabled")}):"function"==typeof a.done&&a.done(function(){f.removeAttr("disabled")}),a)});$pf.initFileField=function(a){a.change(function(b){b=$(this);var c=b[0].files;null!==c&&void 0!==c&&0<c.length&&b.parent().find("span").text(c[0].name)})};
$pf.initCheckBoxField=function(a,b){b.css("cursor","default");b.click(function(){a.click()})};$(document).ready(function(){$pf.initFileField($(".pf-fileupload input[type=file]"));var a=$("span.choose span.text");a.css("cursor","default");a.click(function(){var b=$(this).parent();b.find("input[type=radio]").click();b.find("input[type=checkbox]").click()})});$pf=$pf||{};$pf.templateMessage=$pf.templateMessage||{};
$pf.setFocusTo=function(a,b){if(null!==a&&void 0!==a){var c=getSelection();0<c.rangeCount&&c.removeAllRanges();var e=document.createRange();e.selectNodeContents(a);var f=0;!0===b&&(f=3===a.nodeType?a.nodeValue.length:a.childNodes.length);e.setStart(a,f);e.setEnd(a,f);c.addRange(e);c.collapseToStart();return e}};
$pf.setFocusToX=function(a,b){if(null!==a&&void 0!==a){var c=getSelection();0<c.rangeCount&&c.removeAllRanges();var e=document.createRange();e.selectNodeContents(a);var f=0;null!==b&&void 0!==b&&(f=b);e.setStart(a,f);e.setEnd(a,f);c.addRange(e);c.collapseToStart();return e}};$pf.getTag=function(a){if(null===a||void 0===a)return null;if($pf.isTag(a))return a;a=a.parentNode;return $pf.isTag(a)?a:null};$pf.isTag=function(a){return null!==a&&void 0!==a&&"B"===a.tagName&&a.hasAttribute("pf")};
$pf.isTagEnd=function(a){var b=a.startContainer;return $pf.isTag(b.parentNode)&&b.nodeValue.length===a.startOffset};$pf.isTagStart=function(a){return $pf.isTag(a.startContainer.parentNode)&&0===a.startOffset};$pf.isEmptySpan=function(a){return null!==a&&void 0!==a&&"SPAN"===a.tagName&&a.hasAttribute("pf")&&0===a.innerHTML.indexOf("&nbsp;")};$pf.isTextNode=function(a){return 3===a.nodeType};$pf.isTextNodeEnd=function(a){var b=a.startContainer;return 3===b.nodeType&&a.startOffset===b.nodeValue.length};
$pf.getNextTextNode=function(a){a=a.nextSibling;return 3===a.nodeType?a:null};$pf.fixBogusTag=function(a){var b=a.startContainer.parentNode;if("B"===b.tagName&&(b=b.parentNode,void 0!==b&&"FONT"===b.tagName)){var c=b.nextSibling;b.parentNode.insertBefore(document.createTextNode(a.startContainer.nodeValue),b);b.parentNode.removeChild(b);a.startContainer=c;a.startOffset=0}};
$pf.fixEmptySpan=function(a){var b=a.parentNode,c=a.nextSibling,e=a.innerHTML.replace("&nbsp;","");"&nbsp;"===e&&(e=" ");e=document.createTextNode(e);b.insertBefore(e,c);for(e=1;e<a.childNodes.length;e++)b.insertBefore(a.childNodes[e],c);a.innerHTML="&nbsp;"};
$pf.focusNextIfNextToTag=function(a){var b=a.startContainer,c=null;if($pf.isEmptySpan(a.startContainer))$pf.fixEmptySpan(a.startContainer),b=a.startContainer,$pf.isTag(b.previousSibling)&&(c=$pf.setFocusTo(b,!0));else{if($pf.isTagEnd(a)){c=$pf.setFocusTo(b.parentNode.nextSibling);null!==c&&(a.startContainer=c.startContainer,a.startOffset=c.startOffset,$pf.focusNextIfNextToTag(a));return}$pf.isTag(b.previousSibling)&&3===b.nodeType&&0===a.startOffset&&(""===b.nodeValue?(b.nodeValue=" ",c=$pf.setFocusTo(b,
!0)):0<b.nodeValue.length&&(c=$pf.setFocusToX(b,1)))}null!==c&&(a.startContainer=c.startContainer,a.startOffset=c.startOffset)};$pf.dealFocusExtend=function(a,b){var c=$pf.getTag(a.startContainer);null!==c&&(b=0!==a.startOffset?"left"===b?$pf.setFocusTo(c.previousSibling,!0):$pf.setFocusTo(c.nextSibling):$pf.setFocusTo(c.previousSibling,!0),null!==b&&(a.startContainer=b.startContainer,a.startOffset=b.startOffset));$pf.focusNextIfNextToTag(a)};
$pf.getFocus=function(a){a=getSelection().getRangeAt(0);return null!==a?{startOffset:a.startOffset,startContainer:a.startContainer}:null};function getIdxRelativeParent(a){for(var b=a.parentNode.childNodes,c=0;c<b.length;c++)if(b[c]===a)return c}function getChildByIdx(a,b){return a.childNodes[b]}
$pf.dealFocusL=function(a){var b=getSelection().getRangeAt(0).startContainer;b=$pf.getTag(b);if(null!==b&&null!==b.innerText){var c=null;null!==b.nextSibling?c=$pf.setFocusTo(b.nextSibling):null!==b.previousSibling&&(c=$pf.setFocusTo(b.previousSibling,!0));b.parentNode.removeChild(b);null!==c&&(a.startContainer=c.startContainer,a.startOffset=c.startOffset)}$pf.focusNextIfNextToTag(a)};$pf.getNextDom=function(a){return null!==a.nextSibling?a.nextSibling:$pf.isMsgArea(a.parentNode)?null:$pf.getNextDom(a.parentNode)};
$pf.isIncompleteTag=function(a){a=$pf.getTag(a);if(null===a)return!1;a=a.innerText;return!(null!==a&&"["===a[0]&&"]"===a[a.length-1])};
$pf.dealFocusR=function(a){var b=a.startContainer,c=null;null!==$pf.getTag(b)?$pf.isIncompleteTag(b)?c=b:(b=$pf.getNextDom(b),$pf.isIncompleteTag(b)&&(c=b)):$pf.isTextNodeEnd(a)&&(b=$pf.getNextDom(b),$pf.isIncompleteTag(b)&&(c=b));if(null!==c){c=$pf.getTag(c);b=c.nextSibling;var e=$pf.getNextDom(b),f=c.parentNode;f.removeChild(c);f.removeChild(b);c=$pf.setFocusTo(e);null!==c&&(a.startContainer=c.startContainer,a.startOffset=c.startOffset)}};
$pf.newTag=function(a){var b=document.createElement("b");b.innerText="["+a+"]";b.setAttribute("pf","pf");return b};$pf.newEmptySpan=function(){var a=document.createElement("span");a.innerHTML="&nbsp;";a.setAttribute("pf","pf");return a};$pf.isMsgArea=function(a){return"DIV"===a.tagName&&"msg-area"===a.className};
$pf.getAddTag=function(a,b){var c=null;if($pf.isEmptySpan(b.startContainer.parentNode)&&"&nbsp;"!==b.startContainer.parentNode.innerHTML){var e=b.startContainer.parentNode;$pf.fixEmptySpan(e,b);c=$pf.setFocusToX(e.nextSibling,b.startOffset-1);b.startContainer=c.startContainer;b.startOffset=c.startOffset}a=$pf.newTag(a);if($pf.isEmptySpan(b.startContainer)){e=b.startContainer;var f=$pf.newEmptySpan(),g=e.parentNode;0===b.startOffset?g.insertBefore(a,e):(c=e.nextSibling,g.insertBefore(a,c),g.insertBefore(f,
c),c=$pf.setFocusTo(f))}else if($pf.isMsgArea(b.startContainer))g=b.startContainer,c=document.createTextNode(" "),e=document.createTextNode(" "),f=$pf.newEmptySpan(),g.appendChild(c),g.appendChild(a),g.appendChild(f),g.appendChild(e),c=$pf.setFocusTo(e);else if($pf.isTag(b.startContainer))f=$pf.getTag(b.startContainer),g=f.parentNode,0===b.startOffset?(g.insertBefore(a,f),c=$pf.setFocusTo(f)):(g.insertAfter(a,f),c=$pf.setFocusTo(a));else if($pf.isEmptySpan(b.startContainer.parentNode))e=b.startContainer.parentNode,
f=$pf.newEmptySpan(),g=e.parentNode,c=e.nextSibling,g.insertBefore(a,c),g.insertBefore(f,c),c=$pf.setFocusTo(f);else if($pf.isTextNode(b.startContainer)){f=b.startContainer;e=b.startOffset;g=f.parentNode;var k=f.nodeValue;c=k.substring(0,e);e=k.substring(e,k.length);c=document.createTextNode(c);e=document.createTextNode(e);k=$pf.newEmptySpan();g.insertBefore(c,f);g.insertBefore(a,f);g.insertBefore(k,f);g.insertBefore(e,f);g.removeChild(f);c=$pf.setFocusTo(k)}else 1===b.startContainer.nodeType&&(e=
b.startContainer,g=e.parentNode,f=$pf.newEmptySpan(),0===b.startOffset&&(g.insertBefore(a,e),g.insertBefore(f,e),c=$pf.setFocusTo(e)));null!==c&&(b.startContainer=c.startContainer,b.startOffset=c.startOffset);$pf.focusNextIfNextToTag(b)};
var vm=new Vue({el:"#div-template",data:{data1:[{id:1,name:"\u5ba2\u6237\u540d\u79f0"},{id:2,name:"\u5ba2\u6237\u8054\u7cfb\u4eba"}],data2:[{id:3,name:"\u4f1a\u5458\u59d3\u540d"},{id:4,name:"\u4f1a\u5458\u7b49\u7ea7"}],data3:[{id:5,name:"\u95e8\u5e97\u540d\u79f0"},{id:6,name:"\u6d88\u8d39\u65f6\u95f4"}]}}),msgAreaF=$("div.msg-area"),obj=msgAreaF[0],cursorIndex=null,cursorFocus=null,lastKeyCode=0,allKeyWords=[],keyWordsJson={};
obj.addEventListener("click",function(a){cursorFocus=$pf.getFocus(obj);$pf.dealFocusExtend(cursorFocus)});
obj.addEventListener("keyup",function(a){cursorFocus=$pf.getFocus(obj);if(219==a.keyCode){a.preventDefault();var b=obj.innerText.slice(cursorIndex-1,cursorIndex);/\u3011/g.test(b)&&"\u3010"===obj.innerText.charAt(cursorIndex-2)&&(obj.innerText=obj.innerText.slice(0,cursorIndex-2)+obj.innerText.slice(cursorIndex,obj.innerText.length))}else 221==a.keyCode&&(a.preventDefault(),b=obj.innerText.slice(cursorIndex-1,cursorIndex),/\u3011/g.test(b)&&(obj.innerText=obj.innerText.slice(0,cursorIndex-1)+obj.innerText.slice(cursorIndex,
obj.innerText.length)));37!=a.keyCode&&39!=a.keyCode&&38!=a.keyCode&&40!=a.keyCode||219===lastKeyCode?8==a.keyCode?$pf.dealFocusL(cursorFocus):46==a.keyCode?$pf.dealFocusR(cursorFocus):(a=$("#msg-area-count"),b=obj.innerText.replace(/\[[^\[\]]+\]\s/g,""),null!==b&&a.text("\u5171 "+b.length+" \u5b57")):$pf.dealFocusExtend(cursorFocus,37==a.keyCode?"left":"");$pf.fixBogusTag(cursorFocus)},!1);
obj.addEventListener("keydown",function(a){221!=a.keyCode&&219!=a.keyCode||a.preventDefault();37!=a.keyCode&&39!=a.keyCode||219!==lastKeyCode||a.preventDefault()},!1);function allowDrop(a){a.preventDefault()}function drag(a){a.originalEvent.dataTransfer.setData("Text",a.target.innerText)}
function drop(a){a.preventDefault();var b=a.clientX,c=a.clientY;1>getSelection().rangeCount&&$pf.setFocusTo(msgAreaF[0]);b=$pf.selectNodeByXY(b,c);a=a.originalEvent.dataTransfer.getData("Text");$pf.setFocusToX(b.node,b.pos);cursorFocus=$pf.getFocus(obj);$pf.dealFocusExtend(cursorFocus);$pf.getAddTag(a,cursorFocus)}$(".param-btn").attr("draggable",!0).on("dragover",allowDrop).on("dragstart",drag);msgAreaF.on("drop",drop);
document.addEventListener("click",function(a){a.target!==obj&&a.target.getAttribute("isFocus")?null!==cursorFocus&&$pf.objectToBool(obj.getAttribute("contenteditable"))&&(obj.focus(),allKeyWords.push(a.target.innerHTML),$pf.getAddTag(a.target.innerText,cursorFocus)):a.target!=obj&&a.target.parentNode!=obj&&(cursorIndex=null)});